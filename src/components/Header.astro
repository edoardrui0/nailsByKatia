---
import navData from "@data/navData";
import { Icon } from "astro-icon/components";
import { getLocalePath, t } from "i18n:astro";
// import Settings from "./TemplateComponents/Settings.astro";

import logo from "@assets/images/logos/katiaLogo200.png";
---

<header id="cs-navigation">
  <div class="cs-container">
    <!--Nav Logo-->
    <a href={getLocalePath("/")} class="cs-logo" aria-label="back to home">
      <img
        src={logo.src}
        width="60"
        height="60"
        aria-hidden="true"
        decoding="async"
      />
    </a>
    <!--Navigation List-->
    <nav class="cs-nav" role="navigation">
      <!--Mobile Nav Toggle-->
      <button
        class="cs-toggle"
        id="mobile-menu-toggle"
        aria-expanded="false"
        aria-controls="cs-expanded-ul"
        aria-label="mobile menu toggle"
      >
        <div class="cs-box" aria-hidden="true">
          <span class="cs-line cs-line1" aria-hidden="true"></span>
          <span class="cs-line cs-line2" aria-hidden="true"></span>
          <span class="cs-line cs-line3" aria-hidden="true"></span>
        </div>
      </button>
      <!-- We need a wrapper div so we can set a fixed height on the cs-ul in case the nav list gets too long from too many dropdowns being opened and needs to have an overflow scroll. This wrapper acts as the background so it can go the full height of the screen and not cut off any overflowing nav items while the cs-ul stops short of the bottom of the screen, which keeps all nav items in view no matter how mnay there are-->
      <!-- This also allows for easy substitution of CodeStitch navigations. Just replace the .cs-ul-wrapper in the new navigation with this one -->
      <div class="cs-ul-wrapper">
        <ul id="cs-expanded-ul" class="cs-ul">
          <!-- Note: `:any` is solely used to stop the TypeScript warnings. It's an upstream issue with the i18n package which does not impact the code. -->
          {
            navData.map((entry: any) => (
              <li
                class:list={[
                  "cs-li",
                  { "cs-dropdown": entry.children?.length > 0 },
                ]}
              >
                {entry.children?.length > 0 ? (
                  // If entry has children in navData.json, create a button and a dropdown icon
                  <button
                    aria-expanded="false"
                    aria-controls={`submenu-${entry.key}`}
                    class:list={[
                      "cs-li-link cs-dropdown-button",
                      { "cs-active": Astro.url.pathname.includes(entry.url) },
                    ]}
                  >
                    {t(entry.key)}
                    <Icon name="mdi--caret" class="cs-drop-icon" />
                  </button>
                ) : (
                  // If entry does not have children in navData.json, create an anchor
                  <a
                    href={getLocalePath(entry.url)}
                    class:list={[
                      "cs-li-link",
                      {
                        "cs-active":
                          Astro.url.pathname === getLocalePath(entry.url),
                      },
                    ]}
                    aria-current={
                      Astro.url.pathname === getLocalePath(entry.url)
                        ? "page"
                        : undefined
                    }
                  >
                    {t(entry.key)}
                  </a>
                )}

                {entry.children?.length > 0 && (
                  // If entry has children in navData.json, create a drop down menu
                  <ul id={`submenu-${entry.key}`} class="cs-drop-ul">
                    {entry.children.map((child: any) => (
                      <li class="cs-drop-li">
                        <a
                          href={getLocalePath(child.url)}
                          class="cs-li-link cs-drop-link"
                          aria-current={
                            Astro.url.pathname === getLocalePath(child.url)
                              ? "page"
                              : undefined
                          }
                        >
                          {t(child.key)}
                        </a>
                      </li>
                    ))}
                  </ul>
                )}
              </li>
            ))
          }
        </ul>
        <!-- shown on mobile menu by default  -->
        <!-- <div class="cs-shown cs-settings">
          <Settings />
        </div> -->
      </div>
    </nav>
    <!-- <a href={getLocalePath("/contact")} class="cs-button-solid cs-nav-button"
      >Contact</a
    > -->

    <!-- shown on desktop menu by default  -->
    <!-- <div class="cs-hidden cs-settings">
      <Settings />
    </div> -->
  </div>
</header>

<style lang="less">
  /*-- -------------------------- -->
<---      Dark Mode Toggle      -->
<--- -------------------------- -*/

  /* Mobile - 360px */
  @media only screen and (min-width: 0rem) {
    body.dark-mode {
      #dark-mode-toggle {
        .cs-sun {
          transform: translate(-50%, -50%);
          opacity: 1;
        }

        .cs-moon {
          transform: translate(-50%, -150%);
          opacity: 0;
        }
      }
    }

    #dark-mode-toggle {
      display: block;
      position: absolute;
      top: 50%;
      right: (90/16rem);
      width: (48/16rem);
      height: (48/16rem);
      background: transparent;
      border: none;
      overflow: hidden;
      padding: 0;
      z-index: 1000;
      transform: translateY(-50%);

      img,
      svg {
        //center image inside button
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: (20/16rem);
        height: (20/16rem);
        pointer-events: none;
      }

      .cs-moon {
        z-index: 2;
        // Transition properties
        transition:
          transform 0.3s,
          opacity 0.3s;
        fill: #fff;
      }

      .cs-sun {
        z-index: 1;
        // Transition property
        transform: translate(-50%, 100%);
        opacity: 0;
        transition:
          transform 0.3s,
          opacity 0.3s;
      }
    }
  }

  /* Desktop - 1024px */
  @media only screen and (min-width: 64rem) {
    #dark-mode-toggle {
      position: relative;
      transform: none;
      top: auto;
      right: auto;
      margin: 0;

      &:hover {
        cursor: pointer;
      }
    }
  }

  /*-- -------------------------- -->
<---     Mobile Navigation      -->
<--- -------------------------- -*/

  /* Mobile - 1023px */
  @media only screen and (max-width: 63.9375rem) {
    body {
      &.cs-open {
        overflow: hidden;
      }

      &.scroll {
        #cs-navigation {
          &:before {
            height: 100%;
          }
        }
      }
    }

    #cs-navigation {
      width: 100%;
      padding: (20/16rem) (16/16rem);
      /* prevents padding and border from affecting height and width */
      box-sizing: border-box;
      background: rgba(26, 26, 26, 0.08);
      -webkit-backdrop-filter: blur(27px);
      backdrop-filter: blur(27px);
      position: fixed;
      z-index: 10000;
      transition: background-color 0.3s;

      &:before {
        content: "";
        width: 100%;
        height: 0%;
        background: #1a1a1a;
        opacity: 1;
        position: absolute;
        display: block;
        top: 0;
        left: 0;
        transition: height 0.3s;
      }

      &:after {
        content: "";
        width: 100%;
        height: 0vh;
        background: rgba(0, 0, 0, 0.6);
        -webkit-backdrop-filter: blur(10px);
        backdrop-filter: blur(10px);
        position: absolute;
        display: block;
        top: 0%;
        right: 0;
        z-index: -1100;
        opacity: 0;
        transition:
          height 0.5s,
          opacity 0.5s;
      }

      &.cs-active {
        background-color: #1a1a1a;
        &:after {
          height: 150vh;
          opacity: 1;
        }

        .cs-ul-wrapper {
          opacity: 1;
          transform: scaleY(1);
          transition-delay: 0.15s;
        }

        .cs-li {
          transform: translateY(0);
          opacity: 1;
        }
      }

      .cs-container {
        width: 100%;
        display: flex;
        justify-content: flex-end;
        align-items: center;
      }

      .cs-logo {
        width: auto;
        /* 56px - 80px */
        height: clamp(5rem, 5vw, 5rem);
        margin: 0 auto 0 0;
        padding: 0;
        /* prevents padding and border from affecting height and width */
        box-sizing: border-box;
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 10;

        img {
          width: 100%;
          height: 100%;
          /* ensures the image never overflows the container. It stays contained within it's width and height and expands to fill it then stops once it reaches an edge */
          object-fit: contain;
        }
      }

      .cs-toggle {
        width: (56/16rem);
        height: (56/16rem);
        margin: 0 0 0 auto;
        background-color: var(--primary);
        border: none;
        display: flex;
        justify-content: center;
        align-items: center;
        transition: transform 0.6s;
        position: relative;
        z-index: 10;

        &.cs-active {
          transform: rotate(180deg);
        }
      }

      .cs-active {
        .cs-line1 {
          top: 50%;
          transform: translate(-50%, -50%) rotate(225deg);
        }

        .cs-line2 {
          top: 50%;
          transform-origin: center;
          transform: translate(-50%, -50%) translateY(0) rotate(-225deg);
        }

        .cs-line3 {
          bottom: 100%;
          opacity: 0;
        }
      }

      .cs-box {
        /* 24px - 28px */
        width: clamp(1.5rem, 2vw, 1.75rem);
        height: (16/16rem);
        position: relative;
      }

      .cs-line {
        width: 100%;
        height: 2px;
        border-radius: 2px;
        background-color: #fafbfc;
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
      }

      .cs-line1 {
        top: 0;
        transform-origin: center;
        transition:
          transform 0.5s,
          top 0.3s,
          left 0.3s;
        animation-duration: 0.7s;
        animation-timing-function: ease;
        animation-fill-mode: forwards;
        animation-direction: normal;
      }

      .cs-line2 {
        top: 50%;
        transform: translateX(-50%) translateY(-50%);
        transition:
          top 0.3s,
          left 0.3s,
          transform 0.5s;
        animation-duration: 0.7s;
        animation-timing-function: ease;
        animation-fill-mode: forwards;
        animation-direction: normal;
      }

      .cs-line3 {
        bottom: 0;
        transition:
          bottom 0.3s,
          opacity 0.3s;
      }

      .cs-ul-wrapper {
        width: 100%;
        height: auto;
        padding-bottom: (48/20em);
        opacity: 0;
        background-color: #fff;
        box-shadow: inset rgba(0, 0, 0, 0.2) 0px 8px 24px;
        overflow: hidden;
        position: absolute;
        top: 100%;
        left: 0;
        z-index: -1;
        transform: scaleY(0);
        transform-origin: top;
        transition:
          transform 0.4s,
          opacity 0.3s;
      }

      .cs-ul {
        margin: 0;
        padding: (48/16rem) 0 0 0;
        width: 100%;
        height: auto;
        max-height: 65vh;
        overflow: scroll;
        display: flex;
        justify-content: flex-start;
        flex-direction: column;
        align-items: center;
        gap: (20/16rem);
      }

      .cs-li {
        width: 100%;
        text-align: center;
        list-style: none;
        margin-right: 0;
        /* transition from these values */
        transform: translateY(-4.375rem);
        opacity: 0;
        transition:
          transform 0.6s,
          opacity 0.9s;

        &:nth-of-type(1) {
          transition-delay: 0.05s;
        }
        &:nth-of-type(2) {
          transition-delay: 0.1s;
        }
        &:nth-of-type(3) {
          transition-delay: 0.15s;
        }
        &:nth-of-type(4) {
          transition-delay: 0.2s;
        }
        &:nth-of-type(5) {
          transition-delay: 0.25s;
        }
        &:nth-of-type(6) {
          transition-delay: 0.3s;
        }
        &:nth-of-type(7) {
          transition-delay: 0.35s;
        }
        &:nth-of-type(8) {
          transition-delay: 0.4s;
        }
        &:nth-of-type(9) {
          transition-delay: 0.45s;
        }
        &:nth-of-type(10) {
          transition-delay: 0.5s;
        }
        &:nth-of-type(11) {
          transition-delay: 0.55s;
        }
        &:nth-of-type(12) {
          transition-delay: 0.6s;
        }
        &:nth-of-type(13) {
          transition-delay: 0.65s;
        }
      }

      .cs-li-link {
        /* 16px - 24px */
        font-size: clamp(1rem, 2.5vw, 1.5rem);
        line-height: 1.2em;
        text-transform: uppercase;
        font-weight: bold;
        text-decoration: none;
        margin: 0;
        color: var(--headerColor);
        display: inline-block;
        position: relative;

        &.cs-active {
          color: var(--primary);
        }

        &:hover {
          color: var(--primary);
        }
      }

      .cs-button-solid {
        display: none;
      }
    }
  }

  /* Dark Mode */
  @media only screen and (max-width: 63.9375rem) {
    body.dark-mode {
      #cs-navigation {
        background-color: var(--dark);

        .cs-logo {
          /* makes it white */
          filter: grayscale(1) brightness(1000%);
        }

        .cs-line {
          background-color: #fff;
        }

        .cs-ul-wrapper {
          background-color: var(--medium);
        }

        .cs-li-link {
          color: var(--bodyTextColorWhite);
        }
      }
    }
  }

  /*-- -------------------------- -->
<---     Navigation Dropdown    -->
<--- -------------------------- -*/

  /* Mobile - 1023px */
  @media only screen and (max-width: 63.9375rem) {
    #cs-navigation {
      .cs-li {
        text-align: center;
        width: 100%;
        display: block;
      }

      .cs-dropdown {
        position: relative;
        color: var(--bodyTextColorWhite);
        &.cs-active {
          .cs-drop-ul {
            height: auto;
            opacity: 1;
            visibility: visible;
            margin: (12/16rem) 0 0 0;
            padding: (12/16rem) 0;
          }

          .cs-drop-link {
            opacity: 1;
          }

          .cs-drop-icon {
            transform: translateY(-50%) rotate(180deg);
          }
        }

        .cs-li-link {
          position: relative;
          transition: opacity 0.3s;
          background: none;
          border: none;
        }
      }

      .cs-drop-icon {
        width: (15/16rem);
        height: auto;
        position: absolute;
        top: 50%;
        right: (-20/16rem);
        transform: translateY(-50%);
        transition: transform 0.3s;
      }

      .cs-drop-ul {
        width: 100%;
        height: 0;
        margin: 0;
        padding: 0;
        background-color: var(--primary);
        overflow: hidden;
        opacity: 0;
        visibility: hidden;
        display: flex;
        justify-content: flex-start;
        flex-direction: column;
        align-items: center;
        gap: (12/16rem);
        transition:
          padding 0.3s,
          margin 0.3s,
          height 0.3s,
          opacity 0.3s,
          visibility 0.3s;
      }

      .cs-drop-li {
        list-style: none;
      }

      .cs-li-link {
        &.cs-drop-link {
          /* 14px - 16px */
          font-size: clamp(0.875rem, 2vw, 1.25rem);
          color: #fff;
        }
      }
    }
  }

  /* Desktop - 1024px */
  @media only screen and (min-width: 64rem) {
    #cs-navigation {
      .cs-dropdown {
        position: relative;
        &:hover {
          cursor: pointer;
          .cs-drop-ul {
            transform: scaleY(1);
            opacity: 1;
            visibility: visible;
          }

          .cs-drop-li {
            opacity: 1;
            transform: translateY(0);
          }
        }
      }

      .cs-drop-icon {
        width: (15/16rem);
        height: auto;
        display: inline-block;
        transform: rotate(180deg);
      }

      .cs-drop-ul {
        min-width: (200/16rem);
        margin: 0;
        padding: 0;
        background-color: #1a1a1a;
        overflow: hidden;
        opacity: 0;
        visibility: hidden;
        border-bottom: 5px solid var(--primary);
        /* if you have 8 or more links in your dropdown nav, uncomment the columns property to make the list into 2 even columns. Change it to 3 or 4 if you need extra columns. Then remove the transition delays on the cs-drop-li so they don't have weird scattered animations */
        // columns: 2;
        position: absolute;
        top: 99.5%;
        z-index: -100;
        transform: scaleY(0);
        transform-origin: top;
        transition:
          transform 0.3s,
          visibility 0.3s,
          opacity 0.3s;
      }

      .cs-drop-li {
        list-style: none;
        font-size: (16/16rem);
        text-decoration: none;
        opacity: 0;
        width: 100%;
        height: auto;
        display: block;
        transform: translateY(-0.625rem);
        transition:
          opacity 0.6s,
          transform 0.6s;

        &:nth-of-type(1) {
          transition-delay: 0.05s;
        }
        &:nth-of-type(2) {
          transition-delay: 0.1s;
        }
        &:nth-of-type(3) {
          transition-delay: 0.15s;
        }
        &:nth-of-type(4) {
          transition-delay: 0.2s;
        }
        &:nth-of-type(5) {
          transition-delay: 0.25s;
        }
        &:nth-of-type(6) {
          transition-delay: 0.3s;
        }
        &:nth-of-type(7) {
          transition-delay: 0.35s;
        }
        &:nth-of-type(8) {
          transition-delay: 0.4s;
        }
        &:nth-of-type(9) {
          transition-delay: 0.45s;
        }
      }

      .cs-li-link {
        &:hover {
          .cs-drop-icon {
            filter: grayscale(1) brightness(1000%);
          }
        }
        &.cs-drop-link {
          white-space: nowrap;
          width: 100%;
          font-size: (16/16rem);
          line-height: 1.5em;
          text-decoration: none;
          padding: (12/16rem);
          /* prevents padding and border from affecting height and width */
          box-sizing: border-box;
          color: var(--bodyTextColorWhite);
          display: block;
          transition:
            color 0.3s,
            background-color 0.3s;

          &:hover {
            background-color: var(--primary);
            color: var(--bodyTextColorWhite);
          }

          &:before {
            display: none;
          }
        }
      }
    }
  }

  /*-- -------------------------- -->
<---     Desktop Navigation     -->
<--- -------------------------- -*/

  /* Small Desktop - 1024px */
  @media only screen and (min-width: 64rem) {
    body.scroll {
      /* when the scroll class is on the body, run these styles */
      #cs-navigation {
        &:before {
          height: 100%;
        }
      }
    }

    #cs-navigation {
      width: 100%;
      padding: 0 (16/16rem);
      /* prevents padding and border from affecting height and width */
      box-sizing: border-box;
      background: rgba(26, 26, 26, 0.08);
      -webkit-backdrop-filter: blur(27px);
      backdrop-filter: blur(27px);
      position: fixed;
      z-index: 10000;

      &:before {
        /* on scroll background */
        content: "";
        width: 100%;
        height: 0%;
        background: #1a1a1a;
        opacity: 1;
        position: absolute;
        display: block;
        top: 0;
        left: 0;
        transition: height 0.3s;
      }

      .cs-container {
        width: 100%;
        /* same height as the cs-ul-wrapper */
        height: (100/16rem);
        max-width: (1280/16rem);
        margin: auto;
        display: flex;
        justify-content: flex-end;
        align-items: center;
        gap: (24/16rem);
        position: relative;
      }

      .cs-toggle {
        display: none;
      }

      .cs-logo {
        width: auto;
        height: (60/12rem);
        /* margin-right auto pushes everything away from it to the right */
        margin: 0 auto 0 0;
        padding: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 100;

        img {
          width: 100%;
          height: 100%;
          /* ensures the image never overflows the container. It stays contained within it's width and height and expands to fill it then stops once it reaches an edge */
          object-fit: contain;
        }
      }

      .cs-ul-wrapper {
        /* absolutely positioned to be dead center */
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
      }

      .cs-ul {
        width: 100%;
        margin: 0;
        padding: 0;
        display: flex;
        justify-content: flex-start;
        align-items: center;
        gap: (24/16rem);
      }

      .cs-li {
        list-style: none;
        padding: (40/16rem) 0;
        /* prevent flexbox from squishing it */
        flex: none;
      }

      .cs-li-link {
        /* 14px - 16px */
        font-size: clamp(0.875rem, 0.6vw, 1rem);
        line-height: 1.5em;
        font-weight: 700;
        text-decoration: none;
        text-transform: uppercase;
        margin: 0;
        padding: 0 (16/16rem);
        color: var(--bodyTextColorWhite);
        display: block;
        position: relative;
        z-index: 1;
        transition: color 0.3s;
        background: none;
        border: none;

        &:before {
          /* on scroll background */
          content: "";
          width: 100%;
          height: (40/16rem);
          background: var(--primary);
          opacity: 0;
          position: absolute;
          display: block;
          top: 50%;
          left: 50%;
          z-index: -1;
          transform: translate(-50%, -50%) scale(1.2);
          transition:
            opacity 0.3s,
            transform 0.3s;
        }

        &:hover {
          &:before {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
          }
        }

        &.cs-active {
          &:before {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
          }
        }
      }

      .cs-button-solid {
        font-size: (16/16rem);
        /* 46px - 56px */
        line-height: clamp(2.875em, 5.5vw, 3.2em);
        text-decoration: none;
        font-weight: 700;
        text-align: center;
        margin: 0;
        color: #fff;
        min-width: (150/16rem);
        padding: 0 (32/16rem);
        background-color: transparent;
        border: 1px solid var(--primary);
        display: inline-block;
        position: relative;
        z-index: 1;
        /* prevents padding from adding to the width */
        box-sizing: border-box;

        &:before {
          content: "";
          position: absolute;
          height: 100%;
          width: 0%;
          background: var(--primary);
          opacity: 1;
          top: 0;
          left: 0;
          z-index: -1;
          transition: width 0.3s;
        }

        &:hover {
          &:before {
            width: 100%;
          }
        }
      }
    }
  }
</style>

<script is:inline>
  // This script adds a class to the body after scrolling 100px
  // and we used these body.scroll styles to create some on scroll
  // animations with the navbar

  document.addEventListener("scroll", (e) => {
    const scroll = document.documentElement.scrollTop;
    if (scroll >= 100) {
      document.querySelector("body").classList.add("scroll");
    } else {
      document.querySelector("body").classList.remove("scroll");
    }
  });
</script>
